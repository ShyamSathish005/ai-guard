var ie=Object.defineProperty;var Xe=(o,i,t)=>i in o?ie(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t;var Ye=(o,i)=>()=>(o&&(i=o(o=0)),i);var Qe=(o,i)=>{for(var t in i)ie(o,t,{get:i[t],enumerable:!0})};var oe=(o,i,t)=>Xe(o,typeof i!="symbol"?i+"":i,t);var fe={};Qe(fe,{default:()=>tr});async function rr(o={}){var i,t=o,s=!!globalThis.window,c=!!globalThis.WorkerGlobalScope,n=globalThis.process?.versions?.node&&globalThis.process?.type!="renderer",u=[],v="./this.program",g=import.meta.url,d="",S,A;if(s||c){try{d=new URL(".",g).href}catch{}c&&(A=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),S=async e=>{var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw new Error(r.status+" : "+r.url)}}var E=console.log.bind(console),b=console.error.bind(console),T,y=!1;function _(e){for(var r=0,a=e.length,l=new Uint8Array(a),m;r<a;++r)m=e.charCodeAt(r),l[r]=~m>>8&m;return l}var w,x,M,k,I,D,q,ge,me,he,ve,de,Z=!1;function ye(){var e=ae.buffer;M=new Int8Array(e),I=new Int16Array(e),k=new Uint8Array(e),D=new Uint16Array(e),q=new Int32Array(e),ge=new Uint32Array(e),me=new Float32Array(e),he=new Float64Array(e),ve=new BigInt64Array(e),de=new BigUint64Array(e)}function we(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)Be(t.preRun.shift());L(K)}function _e(){Z=!0,C.b()}function Re(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)Ne(t.postRun.shift());L(V)}function be(e){t.onAbort?.(e),e="Aborted("+e+")",b(e),y=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw x?.(r),r}var $;function Ee(){return _('\0asm\0\0\0`\x7F\x7F`\0\x7F`\x7F\0`\0\0\0\0\x07\xA2\x80\x80	\x7FA\x90\x90\x84\v\x07a\0b\0c\0d\0e\0f\0\0\f\n\xC1\0#\0\v\0#\0 \0kApq"\0$\0 \0\v\0 \0$\0\v\x9E\b\x7FA\x7F!A\x80\bA\x7F6\0@\x7F@@ \0"\x07AqE\r\0A\0 \0-\0\0E\r@ \0Aj"\0AqE\r \0-\0\0\r\0\v\f\v@ \0"Aj!\0A\x80\x82\x84\b (\0"\bk \brA\x80\x81\x82\x84xqA\x80\x81\x82\x84xF\r\0\v@ "\0Aj! \0-\0\0\r\0\v\v \0 \x07k\v"A\0L\r\0\x7F@A\xFF\xFF\xFF\0 A\xFF\xFF\xFF\0F\r   \x07j-\0\0"\0:\0\x90 Aq!A\0!@ \r\0 \0A\xDC\0F@A!\f\v \0A"F@ As!\f\v Aq@A!\f\v@@@ \0A\xDB\0G@ \0A\xFB\0G\r A\xFE\x07J\rA\0!A\x80\b Aj"\x006\0 A\x91\bjA\xFD\0:\0\0 \0!\f\v A\xFE\x07J\rA\0!A\x80\b Aj"\x006\0 A\x91\bjA\xDD\0:\0\0 \0!\f\vA\0! \0A\xDFqA\xDD\0G\r A\0H\r -\0\x90\b \0G\rA\x80\b Ak"6\0\f\vA\0!\v\v Aj" G\r\0\v \v! Aq@ A":\0\x90 Aj!\vA\0! A\0H\r\0@ AqAF@ !\f\v AjAq!\0 !@ A\x90j -\0\x90\b:\0\0 Aj! Ak! Aj" \0G\r\0\v\v AO@@ A\x90j A\x90\bj-\0\0:\0\0 A\x91j A\x8F\bj-\0\0:\0\0 A\x92j A\x8E\bj-\0\0:\0\0 A\x93j A\x8D\bj-\0\0:\0\0 Aj! AG Ak!\r\0\v\vA\x80\bA\x7F6\0\v A\x90jA\0:\0\0A\x90\v\0\v\v\v\0A\x80\b\v\xFF\xFF\xFF\xFF')}function ir(e){return e}async function Se(e){return e}async function Te(e,r){try{var a=await Se(e),l=await WebAssembly.instantiate(a,r);return l}catch(m){b(`failed to asynchronously prepare wasm: ${m}`),be(m)}}async function ke(e,r,a){return Te(r,a)}function Pe(){var e={a:Le};return e}async function je(){function e(h,f){return C=h.exports,$e(C),ye(),C}function r(h){return e(h.instance)}var a=Pe();if(t.instantiateWasm)return new Promise((h,f)=>{t.instantiateWasm(a,(p,j)=>{h(e(p,j))})});$??($=Ee());var l=await ke(T,$,a),m=r(l);return m}class or{constructor(r){oe(this,"name","ExitStatus");this.message=`Program terminated with exit(${r})`,this.status=r}}for(var L=e=>{for(;e.length>0;)e.shift()(t)},V=[],Ne=e=>V.push(e),K=[],Be=e=>K.push(e),Ue=!0,xe=e=>re(e),Me=()=>ne(),X=e=>{var r=t["_"+e];return r},Ie=(e,r)=>{M.set(e,r)},We=e=>{for(var r=0,a=0;a<e.length;++a){var l=e.charCodeAt(a);l<=127?r++:l<=2047?r+=2:l>=55296&&l<=57343?(r+=4,++a):r+=3}return r},Ce=(e,r,a,l)=>{if(!(l>0))return 0;for(var m=a,h=a+l-1,f=0;f<e.length;++f){var p=e.codePointAt(f);if(p<=127){if(a>=h)break;r[a++]=p}else if(p<=2047){if(a+1>=h)break;r[a++]=192|p>>6,r[a++]=128|p&63}else if(p<=65535){if(a+2>=h)break;r[a++]=224|p>>12,r[a++]=128|p>>6&63,r[a++]=128|p&63}else{if(a+3>=h)break;r[a++]=240|p>>18,r[a++]=128|p>>12&63,r[a++]=128|p>>6&63,r[a++]=128|p&63,f++}}return r[a]=0,a-m},Fe=(e,r,a)=>Ce(e,k,r,a),Y=e=>te(e),Oe=e=>{var r=We(e)+1,a=Y(r);return Fe(e,a,r),a},Q=globalThis.TextDecoder&&new TextDecoder,De=(e,r,a,l)=>{var m=r+a;if(l)return m;for(;e[r]&&!(r>=m);)++r;return r},ze=(e,r=0,a,l)=>{var m=De(e,r,a,l);if(m-r>16&&e.buffer&&Q)return Q.decode(e.subarray(r,m));for(var h="";r<m;){var f=e[r++];if(!(f&128)){h+=String.fromCharCode(f);continue}var p=e[r++]&63;if((f&224)==192){h+=String.fromCharCode((f&31)<<6|p);continue}var j=e[r++]&63;if((f&240)==224?f=(f&15)<<12|p<<6|j:f=(f&7)<<18|p<<12|j<<6|e[r++]&63,f<65536)h+=String.fromCharCode(f);else{var B=f-65536;h+=String.fromCharCode(55296|B>>10,56320|B&1023)}}return h},He=(e,r,a)=>e?ze(k,e,r,a):"",ee=(e,r,a,l,m)=>{var h={string:R=>{var F=0;return R!=null&&R!==0&&(F=Oe(R)),F},array:R=>{var F=Y(R.length);return Ie(R,F),F}};function f(R){return r==="string"?He(R):r==="boolean"?!!R:R}var p=X(e),j=[],B=0;if(l)for(var U=0;U<l.length;U++){var se=h[a[U]];se?(B===0&&(B=Me()),j[U]=se(l[U])):j[U]=l[U]}var G=p(...j);function Ke(R){return B!==0&&xe(B),f(R)}return G=Ke(G),G},qe=(e,r,a,l)=>{var m=!a||a.every(f=>f==="number"||f==="boolean"),h=r!=="string";return h&&m&&!l?X(e):(...f)=>ee(e,r,a,f,l)},W=new Uint8Array(123),P=25;P>=0;--P)W[48+P]=52+P,W[65+P]=P,W[97+P]=26+P;if(W[43]=62,W[47]=63,t.noExitRuntime&&(Ue=t.noExitRuntime),t.print&&(E=t.print),t.printErr&&(b=t.printErr),t.wasmBinary&&(T=t.wasmBinary),t.arguments&&(u=t.arguments),t.thisProgram&&(v=t.thisProgram),t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.shift()();t.ccall=ee,t.cwrap=qe;var Ge,re,te,ne,Je,Ze,ae;function $e(e){Ge=t._repair_json=e.c,re=e.d,te=e.e,ne=e.f,Je=ae=e.a,Ze=e.__indirect_function_table}var Le={};function Ve(){we();function e(){t.calledRun=!0,!y&&(_e(),w?.(t),t.onRuntimeInitialized?.(),Re())}t.setStatus?(t.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>t.setStatus(""),1),e()},1)):e()}var C;return C=await je(),Ve(),Z?i=t:i=new Promise((e,r)=>{w=e,x=r}),i}var tr,ue=Ye(()=>{tr=rr});var er={CREDIT_CARD:/\b(?:\d{4}[ -]?){3}\d{4}\b/,EMAIL:/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b/,API_KEY:/\b(sk-[a-zA-Z0-9]{20,}|ghp_[a-zA-Z0-9]{36}|gho_[a-zA-Z0-9]{36})\b/,SSN:/\b\d{3}-\d{2}-\d{4}\b/,IPV4:/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/,AWS_KEY:/\b(AKIA[0-9A-Z]{16})\b/,JWT:/\beyJ[a-zA-Z0-9_-]*\.eyJ[a-zA-Z0-9_-]*\.[a-zA-Z0-9_-]*\b/};function ce(o,i=[],t=!1,s=[],c=[]){let n=o,u=[],v=!0,g={...er};for(let A of c)A.name&&A.pattern&&(g[A.name]=A.pattern);let d=i.length>0?i:Object.keys(g),S=s.map(A=>typeof A=="string"?new RegExp(A):A);for(let A of d){let E=g[A];if(!E)continue;let b=new RegExp(E.source,"g"),T=o.match(b);if(T&&T.length>0){let y=T.filter(_=>!S.some(w=>w.test(_)));if(y.length>0&&(v=!1,u.push({type:A,matches:y}),t))for(let _ of y)n=n.replace(_,`[${A}_REDACTED]`)}}return{safe:v,findings:u,text:n}}function J(o){if(!o)return"";let i=o.trim();return i=i.replace(/^```[a-zA-Z]*\s*/,""),i=i.replace(/\s*```$/,""),i}function z(o,i={}){if(!o)return"";let{last:t=!0}=i,s=o;s=s.replace(/<think>[\s\S]*?<\/think>/gi,""),s=s.replace(/<think>[\s\S]*$/gi,"");let c=/```(?:json|json5|javascript|js)?\s*([\s\S]*?)(?:```|$)/gi,n=[],u;for(;(u=c.exec(s))!==null;){let y=u[1].trim();y&&(y.startsWith("{")||y.startsWith("["))&&n.push(y)}if(n.length>0)return t?n[n.length-1]:n[0];let v=[],g=0,d=-1,S=!1,A=!1;for(let y=0;y<s.length;y++){let _=s[y];if(A){A=!1;continue}if(_==="\\"&&S){A=!0;continue}if(_==='"'&&!A){S=!S;continue}S||(_==="{"||_==="["?(g===0&&(d=y),g++):(_==="}"||_==="]")&&(g--,g===0&&d!==-1&&(v.push(s.slice(d,y+1)),d=-1)))}if(d!==-1&&g>0&&v.push(s.slice(d)),v.length>0)return t?v[v.length-1]:v[0];let E=s.indexOf("{"),b=s.indexOf("[");if(E===-1&&b===-1)return s.trim();let T=E===-1?b:b===-1?E:Math.min(E,b);return s.slice(T).trim()}function le(o,i={}){let{extract:t=!1}=i,s=t?z(o):J(o);if(!s||!s.trim())return"{}";let c=s.trim(),n=[],u=!1,v=!1;for(let g=0;g<c.length;g++){let d=c[g];if(v){v=!1;continue}if(d==="\\"&&u){v=!0;continue}if(d==='"'&&!v){u=!u,u?n.push('"'):n.length>0&&n[n.length-1]==='"'&&n.pop();continue}u||(d==="{"?n.push("{"):d==="["?n.push("["):d==="}"?n.length>0&&n[n.length-1]==="{"&&n.pop():d==="]"&&n.length>0&&n[n.length-1]==="["&&n.pop())}for(u&&(c+='"',n.length>0&&n[n.length-1]==='"'&&n.pop()),c=c.replace(/,\s*$/,"");n.length>0;){let g=n.pop();g==="{"?c+="}":g==="["&&(c+="]")}return c}var H=null,Ae=null,pe=!0;async function nr(){if(!H){if(!pe)throw new Error("Wasm Kernel is disabled in this build.");try{let o=await Promise.resolve().then(()=>(ue(),fe));H=await(o.default||o)(),Ae=H.cwrap("repair_json","string",["string"])}catch(o){throw console.error("Failed to load Wasm kernel:",o),o}}}var N=new Map,O=new Map;async function ar(o){let{name:i,url:t,module:s}=o;if(N.has(i))return{success:!0,name:i,cached:!0};if(O.has(i))return await O.get(i),{success:!0,name:i,cached:!0};let c=(async()=>{try{let n;if(s)n=s;else if(t)n=await import(t);else throw new Error("Plugin requires either url or module");return typeof n.init=="function"&&await n.init(),N.set(i,n),n}catch(n){throw O.delete(i),n}})();return O.set(i,c),await c,{success:!0,name:i}}async function sr(o,i=null){let t=[],s=i?i.filter(c=>N.has(c)):Array.from(N.keys());for(let c of s){let n=N.get(c);if(n&&typeof n.check=="function")try{let u=await n.check(o);if(t.push({name:c,...u}),!u.safe)return{safe:!1,blockedBy:c,reason:u.reason||"Plugin blocked",score:u.score,results:t}}catch(u){t.push({name:c,error:u.message})}}return{safe:!0,results:t}}self.onmessage=async o=>{let{id:i,type:t,payload:s,options:c}=o.data;try{let n;switch(t){case"LOAD_PLUGIN":n=await ar(s);break;case"UNLOAD_PLUGIN":let u=typeof s=="string"?s:s.name;N.delete(u),O.delete(u),n={success:!0,name:u};break;case"LIST_PLUGINS":n={plugins:Array.from(N.keys())};break;case"SCAN_TEXT":let v=typeof s=="string"?s:s?.text,g=c?.rules||s?.enabledRules||[],d=c?.redact??s?.redact??!1,S=c?.allow||s?.allow||[],A=c?.customRules||s?.customRules||[],E=c?.runPlugins??s?.runPlugins??!0,b=c?.plugins||s?.plugins||null;if(n=ce(v,g,d,S,A),n.safe&&E&&N.size>0){let w=await sr(v,b);w.safe?n.pluginResults=w.results:n={...n,safe:!1,blockedBy:w.blockedBy,reason:w.reason,score:w.score,pluginResults:w.results}}break;case"REPAIR_JSON":{let w=typeof s=="string"?s:s?.text,x=c?.extract??s?.extract??!1,M=c?.useWasm&&pe,k;if(M){H||await nr();let q=x?z(w):J(w);k=Ae(q)}else k=le(w,{extract:x});let I=!1,D=null;try{D=JSON.parse(k),I=!0}catch{I=!1}n={fixedString:k,data:D,isValid:I,mode:M?"wasm":"js"}}break;case"EXTRACT_JSON":let T=typeof s=="string"?s:s?.text,y=c?.last??s?.last??!0;n={extracted:z(T,{last:y})};break;default:throw new Error(`Unknown message type: ${t}`)}self.postMessage({id:i,success:!0,payload:n})}catch(n){self.postMessage({id:i,success:!1,error:n.message})}};
